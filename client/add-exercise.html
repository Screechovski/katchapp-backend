<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>добавить упражениния</title>
  <script src="validation.js"></script>
  <script src="main.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">


  <script>
    const loadMuscleGroups = async () => {
      try {
        const token = sessionStorage.getItem('token')
        const muscleGroups = await fetch('/api/muscle-groups', {
          headers: {
            authorization: token,
            'content-type': 'application/json'
          }
        }).then(d => d.json());
        return muscleGroups
      } catch (error) {
        console.warn(error);
        return []
      }
    }

    const renderGroups = (groups) => {
      const $list = document.getElementById('group-list')
      const getTemplate = (id, name) => `<li class="item">
        <label>
          <input class="form-check-input mx-2" name="main-group" type="radio" value="${id}" />
          <span>${name}</span>
        </label>
      </li>`
      $list.innerHTML = ''
      groups.forEach(exercise => {
        $list.insertAdjacentHTML('beforeend', getTemplate(exercise.id, exercise.name))
      });
    }

    const renderSecondaryGroups = (groups) => {
      const $list = document.getElementById('group-add-list')
      const getTemplate = (id, name) => `<li class="item">
        <label class="d-flex align-items-center">
          <input class="form-check-input mx-2" name="subgroup" type="checkbox" value="${id}" />
          <span>${name}</span>
          <input style="width:50px" type="number" class="form-control form-control-sm mx-2" name="" min="1" max="3" value="1">
        </label>
      </li>`
      $list.innerHTML = ''
      groups.forEach(exercise => {
        $list.insertAdjacentHTML('beforeend', getTemplate(exercise.id, exercise.name))
      });
    }

    const createSubmit = () => {
      const $form = document.getElementById('form');

      $form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = new FormData($form);

        const result = await fetch('/api/exercises', {
          method: 'post',
          body: data,
          headers: {
            authorization: token,
          }
        });
      })
    }

    const main = async () => {
      const groups = await loadMuscleGroups();
      renderGroups(groups);
      renderSecondaryGroups(groups);
      createSubmit()
    }

    document.addEventListener('DOMContentLoaded', main)
  </script>
</head>

<body>
  <style>
    .list {
      height: 300px;
      overflow: auto;
      margin: 0;
      padding: 0;
    }

    .item {
      list-style: none;
      padding: 0;
      margin: 0;
      cursor: pointer;
      border-radius: 10px;
    }

    .item:hover {
      background-color: #e6e6e6;
    }

    .item label {
      cursor: pointer;
      width: 100%;
      padding: 4px;
    }
  </style>

  <div class="container">
    <form id="form" class="gap-3">
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label for="name">Название упражнения</label>
            <input type="text" class="form-control" name="name" id="name" placeholder="Шраги со штангой">
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label for="image">Картинка упражнения</label>
            <input class="form-control" type="file" accept="image/png, image/jpeg" name="image" id="image">
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <label>Основная группа мышц</label>
            <ul class="list" id="group-list"></ul>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <label>Дополнительные группы мышц</label>
            <ul class="list" id="group-add-list"></ul>
          </div>
        </div>
      </div>

      <button class="btn btn-primary">отправить</button>
    </form>
  </div>
</body>

</html>